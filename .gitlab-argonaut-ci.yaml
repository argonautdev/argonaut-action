variables:
  task_id:  
    description: 'argonaut unique build run id'
  task_name:
    description: 'task name'
  ref:
    description: 'branch, tag, sha ref to perform build on'
  arg_auth_token:  
    description: 'temporary organization auth token for argonaut'
  extra_args:
    description: 'extra field that can used for future purpose, format : key1=value1,key2=value2,...'

stages:
  - dagger

dagger-execute:
  stage: dagger
  script:
    - which docker
    - which git
    - which go
    - ls -lrt
    - pwd
    - user_repo_dir_root=$(pwd)
    - cd ../..
    - pwd
    - mkdir -m 777 argonaut-action
    - git clone -b main https://github.com/argonautdev/argonaut-action.git
    - cd argonaut-action/ci/
    - ARG_AUTH_TOKEN="$arg_auth_token" go run *.go $task_id ${user_repo_dir_root}